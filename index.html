<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloxy Market</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>
  /* === RESET === */
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Orbitron', sans-serif; }
  body { background: #000; color: #fff; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }

  /* === HEADER === */
  header { text-align: center; margin: 2rem 0; }
  header h1 { font-size: 3rem; background: linear-gradient(90deg,#ffd700,#ffcc33); -webkit-background-clip: text; color: transparent; }

  /* === LOJA === */
  .loja { display: flex; gap: 2rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem; }
  .produto { background: #111; padding: 1.5rem; border-radius: 15px; width: 220px; text-align: center; position: relative; transition: transform 0.3s, box-shadow 0.3s; }
  .produto:hover { transform: translateY(-10px); box-shadow: 0 0 20px #ffd700; }
  .produto h2 { color: #ffd700; margin-bottom: 1rem; }
  .produto p { margin-bottom: 1rem; font-size: 0.9rem; }
  .produto button { padding: 0.5rem 1rem; border: none; border-radius: 8px; background: #ffd700; color: #000; font-weight: bold; cursor: pointer; transition: background 0.3s; }
  .produto button:hover { background: #ffcc33; }

  /* === MODAL === */
  .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 999; }
  .modal-content { background: #111; padding: 2rem; border-radius: 15px; width: 350px; text-align: center; }
  .modal-content h3 { color: #ffd700; margin-bottom: 1rem; }
  .modal-content p { margin-bottom: 1rem; }
  .modal-content button { margin-top: 1rem; width: 100%; }
</style>
</head>
<body>

<header>
  <h1>BLOXY MARKET</h1>
</header>

<section class="loja" id="loja"></section>

<!-- Modal PIX / Código -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle"></h3>
    <p id="modalDesc"></p>
    <button id="btnPaguei">Paguei</button>
    <button id="btnClose" style="margin-top:0.5rem;">Fechar</button>
  </div>
</div>

<script>
const API_BASE = "https://SEU-BOT-URL.herokuapp.com"; // colocar URL do seu bot/Express
let produtos = [
  { id: 1, nome: "STEAL A BRAINROT", tipo:"steal", stock:4, preco: 15.00 },
  { id: 2, nome: "BLOX FRUIT", tipo:"blox", stock:3, preco: 25.00 }
];

// render produtos
const lojaEl = document.getElementById("loja");
function renderProdutos(){
  lojaEl.innerHTML = "";
  produtos.forEach(p => {
    const div = document.createElement("div");
    div.className = "produto";
    div.innerHTML = `
      <h2>${p.nome}</h2>
      <p>Stock: ${p.stock}</p>
      <p>R$ ${p.preco.toFixed(2)}</p>
      <button onclick="comprar(${p.id})">Comprar</button>
    `;
    lojaEl.appendChild(div);
  });
}

// modal
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalDesc = document.getElementById("modalDesc");
const btnPaguei = document.getElementById("btnPaguei");
const btnClose = document.getElementById("btnClose");
let currentProduto = null;
let currentTicketId = null;

function comprar(id){
  const p = produtos.find(x=>x.id===id);
  currentProduto = p;
  // cria ticket via bot
  fetch(`${API_BASE}/ticket`, {
    method: "POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ userId: "USUARIO_DISCORD_ID", painel: p.tipo, produto: p.nome })
  })
  .then(res=>res.json())
  .then(data=>{
    currentTicketId = data.ticketId;
    modalTitle.innerText = p.nome;
    modalDesc.innerHTML = `Chave PIX: <b>${data.pix}</b><br>Valor: R$${p.preco.toFixed(2)}`;
    modal.style.display = "flex";
  })
  .catch(e=>alert("Erro ao criar ticket"));
}

// pagar
btnPaguei.addEventListener("click", ()=>{
  fetch(`${API_BASE}/ticket/confirm`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({ ticketId: currentTicketId })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success){
      modalDesc.innerHTML += `<br><b>Código gerado:</b> ${data.code}`;
      // diminuir estoque
      currentProduto.stock -= 1;
      renderProdutos();
    } else {
      alert("Erro ao confirmar pagamento");
    }
  });
});

btnClose.addEventListener("click", ()=>{ modal.style.display="none"; });

renderProdutos();
</script>

</body>
</html>
